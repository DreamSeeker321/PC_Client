!function(){function e(e,t,a,r){switch(e){case"add":var s=[];s.push('<div class="selectedMember avatarList">'),s.push('<div class="avatar">'),s.push('<img src="dist/imgs/index/app/person.png" alt="">'),s.push("</div>"),0===t.length?s.push('<p checkId="'+a+'" class="selectedName" style="color:#f20000" title="无名称">无名称</p>'):s.push('<p checkId="'+a+'" class="selectedName" title="'+t+'">'+t+"</p>"),s.push("</div>"),$(".gpMember").append(s.join(""));break;case"del":for(var i=$(".gpMember .avatarList"),n=0,c=i.length;n<c;n++)if($(i[n]).find(".selectedName").attr("checkId")==a){$(i[n]).remove();break}}}function t(e,t){var r=t||function(){};void 0==e||""==e?(e=0,url=localStorage.url+"/mobileOrgController/getSelectUserTree.action"):url=localStorage.url+"/mobileOrgController/getSelectUserTree.action?id="+e;var s=$(".choosePerson .orgList-"+e).find("li").length;0===s?$.ajax({type:"post",url:url,beforeSend:function(e){},success:function(t,s){var i=JSON.parse(t);a(i,e),r(),console.log("获取组织结构文件成功！")},complete:function(e,t){},error:function(e){alert("获取数据失败！请检查网络后刷新")}}):r()}function a(e,t){var a=$(".creatGpChat .orgList-"+t).find("li").length,r=$(".creatGpChat .orgList-"+t).parents(".orgList").length;if(0===e.rtData.length){var s=["<li style='padding:10px 0;text-align:center;'>暂无人员！</li>"];return void $(".creatGpChat .orgList-"+t).append(s.join(""))}if(0===a)for(var i=0,n=e.rtData.length;i<n;i++){var c=[],p=10*r;p=10*r,"dept"===e.rtData[i].type?(c.push('<li class="orgItem orgItem-'+r+'" style="padding-left:'+p+'px;box-sizing:border-box;">'),c.push('<p class="orgTitle gpdep" parentId='+e.rtData[i].id+">"),c.push('<span class="caret-right caret-set1"></span>'),c.push("<span class='orgName'>"+e.rtData[i].name+"</span>"),c.push("</p>"),c.push('<ul class="orgList orgList-'+e.rtData[i].id+'">'),c.push("</ul>"),c.push("</li>"),$(".creatGpChat").find(".orgList-"+t).append(c.join(""))):(c.push('<li class="person" style="padding-left:'+p+'px;box-sizing:border-box;">'),c.push('<input type="checkbox" checkId="'+e.rtData[i].userId+'" class="labelForCheck chk_1 '+e.rtData[i].type+e.rtData[i].id+'" />'),c.push('<label class="checkLabel" checkId="'+e.rtData[i].userId+'" for="'+e.rtData[i].type+e.rtData[i].id+'"></label>'),c.push("<div class='avatarItem'>"),c.push('<div class="avatar">'),c.push('<img src="dist/imgs/index/contact/person.png" alt="">'),c.push("</div>"),c.push('<div class="orgname" class="per-'+e.rtData[i].id+'">'+e.rtData[i].name+"</div>"),c.push("</li>"),$(".creatGpChat .orgList-"+t).append(c.join("")))}}$("body").on("change",".labelForCheck",function(t){var a=$(this).prop("checked"),r=$(this).attr("checkId"),s=$(this).siblings(".avatarItem").find(".orgname").text();a?e("add",s,r):e("del",s,r)}),$(".addGpChat").click(function(){$(".creatGpChat").show(),t()}),$("body").on("click",".gpdep .orgName",function(){var e=$(this),a=e.parent().siblings(".orgList").attr("class"),r=a.split(" "),s=r[1].substring(8);t(Number(s),function(){0!==e.parent().siblings(".orgList").find("li").length&&(e.parent().hasClass("open")?(e.parent().find(".caret-set1").css({transform:"rotate(0deg)"}),e.parent().siblings(".orgList").slideUp(),e.parent().removeClass("open")):(e.parent().find(".caret-set1").css({transform:"rotate(45deg)","border-left-color":"#555"}),e.parent().siblings(".orgList").slideDown(),e.parent().addClass("open")))})}),$("body").on("click",".checkLabel",function(){var t=$(this).attr("for"),a=$("."+t).prop("checked");$("."+t).prop("checked",!a);var r=$(this).attr("checkId"),s=$(this).siblings(".avatarItem").find(".orgname").text();a?e("del",s,r):e("add",s,r)}),$(".closeGpChat").click(function(){$(".creatGpChat").hide(),$(".creatGpChat").find(".gpMember").empty(),$(".creatGpChat").find(".orgList").empty(),$(".creatGpChat").find(".gpInput").val("")}),$("body").on("click",".labelForCheck",function(e){e.stopPropagation()}),$("#addGpChat").click(function(e){var t=$(".newGpName").next(".gpInput").val(),a=$(".newGpNotice").next(".gpInput").val();t||(t=localStorage.userName+"的群组");for(var r=$(".selectedMember").length,s="",i=0;i<r;i++)s+=$(".selectedMember").eq(i).find(".selectedName").attr("checkId")+",";s=s.substring(0,s.length-1),IM_ajax("/plugins/zatp?cmd=createroom",{crUser:localStorage.userId,name:t,subject:"",description:a,members:s},function(e){e.status&&(saveOrSetToLocal("sessionName",t,"chat-"+e.gid),$(".creatGpChat").hide(),$(".creatGpChat").find(".gpMember").empty(),$(".creatGpChat").find(".orgList").empty(),$(".creatGpChat").find(".gpInput").val(""))})})}();