function onConnect(t){t==Strophe.Status.CONNFAIL||t==Strophe.Status.AUTHFAIL||(t==Strophe.Status.DISCONNECTED?(console.log("连接断开！"),connected=!1):t==Strophe.Status.CONNECTED&&(connected=!0,connection.addHandler(onMessage,null,"message",null,null,null),connection.send($pres().tree())))}function onMessage(t){var n=(t.getAttribute("from"),t.getAttribute("type")),e=t.getElementsByTagName("body");if("chat"==n&&e.length>0){var o=e[0],I=$(o).html(),p=JSON.parse(I);popChat(p)}return!0}function connecting(){var t=(new Date).getTime();connected||(connection=new Strophe.Connection(BOSH_SERVICE),connection.connect(localStorage.userId+"@zatp/PC_"+t,"trsadmin",onConnect))}function removeHttp(t){if(t.indexOf("https://")!=-1){var n=t.replace("https://","");return n}var n=t.replace("http://","");return n}var net=localStorage.getItem("net");net=JSON.parse(net);var connectTime=0;if(""!=net.IM.ip&&""!=net.IM.port){var nohttp=removeHttp(net.IM.ip);nohttp.indexOf(":")!==-1?"true"==net.IM.check?(IM_IP="https://"+nohttp.substring(0,nohttp.indexOf(":")+1),IM_PORT="7443"):(IM_IP="http://"+nohttp.substring(0,nohttp.indexOf(":")+1),IM_PORT="7070"):"true"==net.IM.check?(IM_IP="https://"+net.IM.ip,IM_PORT=":7443"):(IM_IP="http://"+net.IM.ip,IM_PORT=":7070")}else{if(""!=net.IM.ip&&""==net.IM.port){var nohttp=removeHttp(net.IM.ip);nohttp.indexOf(":")!==-1?"true"==net.IM.check?(IM_IP="https://"+nohttp.substring(0,nohttp.indexOf(":")+1),IM_PORT="7443"):(IM_IP="http://"+nohttp.substring(0,nohttp.indexOf(":")+1),IM_PORT="7070"):"true"==net.IM.check?(IM_IP="https://"+net.IM.ip,IM_PORT=":7443"):(IM_IP="http://"+net.IM.ip,IM_PORT=":7070")}if(""==net.IM.ip&&""!=net.IM.port){var nohttp=removeHttp(localStorage.url);nohttp.indexOf(":")!=-1?"true"==net.IM.check?(IM_IP="https://"+nohttp.substring(0,nohttp.indexOf(":")+1),IM_PORT="7443"):(IM_IP="http://"+nohttp.substring(0,nohttp.indexOf(":")+1),IM_PORT="7070"):(IM_IP=localStorage.url,"true"==net.IM.check?IM_PORT=":7443":IM_PORT=":7070")}if(""==net.IM.ip&&""==net.IM.port){var nohttp=removeHttp(localStorage.url);nohttp.indexOf(":")!=-1?"true"==net.IM.check?(IM_IP="https://"+nohttp.substring(0,nohttp.indexOf(":")+1),IM_PORT="7443"):(IM_IP="http://"+nohttp.substring(0,nohttp.indexOf(":")+1),IM_PORT="7070"):(IM_IP=localStorage.url,"true"==net.IM.check?IM_PORT=":7443":IM_PORT=":7070")}}var BOSH_SERVICE=IM_IP+IM_PORT+"/http-bind/",connection=null,connected=!1,jid="";connecting(),setInterval(connecting,5e3);