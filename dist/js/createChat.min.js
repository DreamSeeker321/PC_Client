function creatChat(i){function a(i){var a=$("#chat-"+i).length;return 0!==a}function e(i){var e=a(i.from_id);e?o():(t(i),o())}function s(i){var e=a(i.to_id);e?o(i.to_id):(t(i),o(i.to_id))}function t(i){var a,e;1==i.type?(a=i.from_id,e=i.from_name):(a=i.to_id,e=i.to_name);var s=$(".dialogContent").clone();s.addClass("dialogContent"+a),$("#mainContent").prepend(s),$(".dialogName").text(e);var t=[];t.push('<li id="'+a+'" class="diaItem diaItem-'+a+' active">'),t.push('<div class="avatar">'),t.push('<img src="dist/imgs/index/avatar.png" alt="">'),t.push("</div>"),t.push('<div class="diaContent">'),t.push('<div class="diaTop clearfix">'),t.push('<span class="diaName">'+e+"</span>"),t.push('<span class="diaTime">'+i.time+"</span>"),t.push("</div>"),t.push('<div class="diaDown clearfix">'),t.push("<p class='fl' style=\"width:300px;height:20px;overflow:hidden;\">"+i.content.substr(0,6)+"...</p>"),t.push("<span class='indicator fr'>99</span>"),t.push("</div>"),t.push("</div>"),t.push("</li>"),$(".diaItem").removeClass("active"),$(".dialogList .chats").append(t.join(""))}function o(i){$("#mainContent > div").hide(),$(".dialogContent"+i).show(),$(".main > ul").hide(),$(".diaItem").removeClass("active"),$(".dialogList").show()}function n(i,a,e){var s=localStorage.item||"{}",t=JSON.parse(s);t.key=a,s=JSON.stringify(t),localStorage.item=s}function d(i,a){var e=localStorage.item||"{}",s=JSON.parse(e);return!!s.key&&s.key}var r=d(r,i.from_id),p=d(p,i.from_id);r&&r||(n("minMsgId",999999,i.from_id),n("maxMsgId",0,i.from_id)),1==i.type?e(i):s(i)}function refreshSessionList(i){var a=$(".chats").find("active").attr("id");getChatList(function(i){$(".chats").empty(),i.forEach(function(i){var a,e,s;i.session_id==i.to_id?(a=i.to_id,e=i.to_name):(a=i.from_id,e=i.from_name),s=1==i.type?"single":"group";var t=[],o=new Date(i.time).getTime(),n=(new Date).getTime(),d=n-o,r="";d>6e4&&d<864e5?recordTime=i.time.substr(-4,5):d>864e5&&d<31536e6?recordTime=i.time.substr(5,5):d>31536e6?recordTime=i.time.substr(0,10):recordTime="刚刚",r=i.content.replace(/<br>/gm," "),0===r.indexOf("[IMG^")&&(r="[图片]"),0===r.indexOf("[FILE^")&&(r="[文件]"),0===r.indexOf("[VOICE^")&&(r="[语音]"),0===r.indexOf("[POS^")&&(r="[位置]"),t.push('<li chatType="'+s+'" id="'+i.session_id+'" id="'+i.session_id+'" class="diaItem diaItem-'+a+'">'),t.push('<div class="avatar">'),t.push('<img src="dist/imgs/index/app/person.png" alt="">'),t.push("</div>"),t.push('<div class="diaContent">'),t.push('<div class="diaTop clearfix">'),t.push('<span class="diaName">'+e+"</span>"),t.push('<span class="diaTime">'+recordTime+"</span>"),t.push("</div>"),t.push('<div class="diaDown clearfix">'),0!==i.count&&t.push("<span class='indicator fr'>"+i.count+"</span>"),t.push("<p class='fl' style=\"width:130px;height:20px;overflow:hidden;white-space:nowrap;white-space:nowrap;\">"+r+"</p>"),t.push("</div>"),t.push("</div>"),t.push("</li>"),$(".dialogList .chats").append(t.join(""))})}),$(".diaItem"+a).addClass("active"),i&&i()}function getOfflineMessages(i){getGlobalMaxMsgId(function(a){$.ajax({url:localStorage.imUrl+"/plugins/zatp?cmd=offlinemsg",data:{maxId:a,userId:localStorage.userId},type:"post",dataType:"json",timeout:1e4,success:function(a){for(var e="",s=0;s<a.length;s++){e=1==a[s].type?a[s].from_id!=localStorage.userId?a[s].toId:a[s].fromId:a[s].toId;var t={id:a[s].id,to_id:a[s].toId,to_name:a[s].toName,from_id:a[s].fromId,from_name:a[s].fromName,type:a[s].type,content:a[s].content,time:a[s].time,user_id:localStorage.userId,flag:0,session_id:e};addChatLog(t)}i()},error:function(i){console.log(i)}})})}