!function(){function s(s){var e=[];if(e.push('<div class="smsBlock">'),e.push('<div class="smsTitle">'),e.push("<p class=' fl'>消息事务</p>"),e.push("<p class='fr readAll'>全部已阅</p>"),e.push("</div>"),e.push('<div class="smsBody">'),e.push('<ul class="smsTab clearfix">'),s.length>6){for(var n=0;n<5;n++)e.push('<li id="'+s[n].id+"\" class='smsTabBlock'>"),e.push('<p class="smsName">'+s[n].name+"</p>"),e.push("</li>");for(e.push("<li class='smsTabBlock'>"),e.push('<p class="smsName moreSmsClass">更多</p>'),e.push('<ul class="moreSms">'),n=5,le=s.length;n<le;n++)e.push('<li id="'+s[n].id+'" class="moreSmsItem">'+s[n].name+"</li>");e.push("</ul>"),e.push("</li>")}else for(var n in s)e.push('<li id="'+s[n].id+"\" class='smsTabBlock'>"),e.push('<p class="smsName">'+s[n].name+"</p>"),e.push("</li>");e.push("</ul>"),e.push('<div class="smsContent">'),e.push('<ul class="smsContentList">');for(var t in s)if(""!=s[t].name&&""!=s[t].id){e.push(o(s[t].id));break}e.push("</ul>"),e.push("</div>"),e.push('<p class="getMore">查看更多>></p>'),$("#mainContent > div").hide(),$("#mainContent").prepend(e.join(""))}function o(s,o,e,n){function t(s,o,e){var n=[];if(0===s.rows.length){$(".getMore").hide(),$(".noMore").show();var t=["<div class ='noMore' style=\"text-align:center;line-height:30px;\">暂无数据！</div>"];return t}$(".getMore").show(),$(".noMore").hide();for(var l=0,a=s.rows.length;l<a;l++)n.push('<li  url="'+s.rows[l].remindUrl+'" smsSid="'+s.rows[l].smsSid+'" class="smsContentItem">'),n.push("<div>"),n.push("<p>"+s.rows[l].content+"</p>"),n.push('<div class="smsInfo clearfix">'),n.push('<p class="fl">'+s.rows[l].fromUser+"</p>"),n.push('<p class="fr">'+s.rows[l].remindTimeDesc+"</p>"),n.push("</div>"),n.push("</div>"),n.push("</li>");return n}var l=e||1,a=a||5,i=n||function(s){$(".smsContentList").append(s.join(""))};$.ajax({type:"post",data:{rows:a,page:l,moduleNo:s},url:localStorage.url+"/sms/getSmsBoxDatas.action",beforeSend:function(s){$(".getMore").text("正在加载...")},success:function(e,n){var l=JSON.parse(e),a=t(l,s,o);i(a),console.log("获取消息内容成功！")},complete:function(s,o){$(".getMore").text("加载更多>>")},error:function(s){alert("获取数据失败！请检查网络后刷新")}})}var e,n=1;$("body").on("click",".allNews",function(){$.ajax({type:"get",url:localStorage.url+"/sms/getUnreadSmsGroup.action",beforeSend:function(s){},success:function(o,e){var n=JSON.parse(o);0==$(".smsBlock").length?($(".smsBlock").remove(),s(n)):($("#mainContent > div").hide(),$(".smsBlock").show()),console.log("获取菜单列表成功！")},complete:function(s,o){},error:function(s){alert("获取数据失败！请检查网络后刷新")}})}),$("body").on("click",".smsTabBlock,.moreSmsItem",function(s){if(0===$(this).find("ul").length){var t=$(this).attr("id");$(this).hasClass("open")||(n=1,o(t,e,n,function(s){$(".smsContentList").empty(),$(".smsContentList").append(s.join(""))}),$(".smsTabBlock,.moreSmsItem").removeClass("open"),$(this).addClass("open"))}}),$("body").on("click",".getMore",function(){var s=$(".open").attr("id");o(s,e,++n,function(s){$(".smsContentList").append(s.join(""))})}),$("body").on("click",".smsContentItem",function(){var s=$(this).attr("smssid"),o=(localStorage.url,$(this).attr("url"));$.post(localStorage.url+"/sms/updateReadFlag.action",{ids:s},function(s,o,e){}),nw.Window.open(localStorage.url+o,{},function(s){s.maximize()}),$.ajax({type:"post",data:{ids:s},url:localStorage.url+"/sms/updateReadFlag.action",beforeSend:function(s){},success:function(s,o){JSON.parse(s)},complete:function(s,o){},error:function(s){alert("获取数据失败！请检查网络后刷新")}})}),$("body").on("click",".readAll",function(){$.post(localStorage.url+"/sms/viewAll.action",function(o,e,n){o.rtState&&$.ajax({type:"get",url:localStorage.url+"/sms/getUnreadSmsGroup.action",beforeSend:function(s){},success:function(o,e){var n=JSON.parse(o);0==$(".smsBlock").length?($(".smsBlock").remove(),s(n)):($("#mainContent > div").hide(),$(".smsBlock").show()),console.log("获取菜单列表成功！")},complete:function(s,o){},error:function(s){alert("获取数据失败！请检查网络后刷新")}})})})}();